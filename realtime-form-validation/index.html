<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>realtime form validation</title>
    <style>
        .input-requirements {
        list-style: disc;
        color: rgb(150,150,150);
        }


        .input-requirements li.invalid {
            color: #e74c3c;
        }
        .input-requirements li.valid {
            color: #2ecc71;
        }

        .input-requirements li.valid:after {
            display: inline-block;
            padding-left: 10px;
            content: "\2713";
        }

        .input-requirements li.invalid:after {
            display: inline-block;
            padding-left: 10px;
            content: "\2715";
        }

        /* Hide and show related .input-requirements when interacting with input */

        input:not([type="submit"]) + .input-requirements {
        overflow: hidden;
        max-height: 0;
        transition: max-height 1s ease-out;  
        }

        input:not([type="submit"]):hover + .input-requirements,
        input:not([type="submit"]):focus + .input-requirements,
        input:not([type="submit"]):active + .input-requirements {
        max-height: 1000px; /* any large number (bigger then the .input-requirements list) */
        transition: max-height 1s ease-in;
        }

    </style>
</head>
<body>
    <form class="registration" id="registration">
        <h1>Registration Form</h1>
        <label for="username">
            <input type="text" placeholder="username" id="username" minlength="3" required>
            <ul class="input-requirements">
                <li>Minimal 3 karakter</li>
                <li>Hanya boleh berisi huruf dan angka (tidak boleh karakter khusus)</li>
            </ul>
        </label>

        <label for="password">
            <span>Password</span>

            <input type="password" id="password" maxlength="100" minlength="8" required>

            <ul class="input-requirements">
                <li>Panjang minimal 8 karakter (dan kurang dari 100 karakter)</li>
                <li>Berisi setidaknya 1 Angka</li>
                <li>Berisi minimal 1 huruf kecil</li>
                <li>Berisi minimal 1 huruf besar</li>
                <li>Berisi karakter khusus (contoh: @ ! & #)</li>
            </ul>
        </label>

        <label for="password_repeat">
            <span>Repeat Password</span>
            <input type="password" id="password_repeat" maxlength="100" minlength="8" required>
        </label>

        <br>

        <input type="submit">
    </form>

    <script type="text/javascript">
        function CustomValidation() {
            this.invalidities = [];

            this.validityChecks = [];
        }

        CustomValidation.prototype = {
            addInvalidity: function (message) {
                this.invalidities.push(message);
            },
            getInvalidities: function () {
                return this.invalidities.join('. \n');
            },
            checkValidity: function (input) {
                for (var i = 0; i < this.validityChecks.length; i++) {
                    var isInvalid = this.validityChecks[i].isInvalid(input);
                    if(isInvalid){
                        this.addInvalidity(this.validityChecks[i].invalidityMessage);
                    }

                    var requirementElement = this.validityChecks[i].element;

                    if(requirementElement){
                        if(isInvalid){
                            requirementElement.classList.add('invalid');
                            requirementElement.classList.remove('valid');
                        }else{
                            requirementElement.classList.remove('invalid');
                            requirementElement.classList.add('valid');
                        }
                    }
                    
                }// end if requirementElement
            }
        };

        // validity check

        var usernameValidityChecks = [
            {
                isInvalid: function (input) {
                    return input.value.length < 3;
                },
                invalidityMessage: 'Minimal 3 karakter',
                element: document.querySelector('label[for="username"] .input-requirements li:nth-child(1)')
            },
            {
                isInvalid:function(input){
                    var illegalCharacters = input.value.match(/[^a-zA-Z0-9]/g);
                    return illegalCharacters ? true : false;
                },
            invalidityMessage:'Hanya boleh berisi huruf dan angka (tidak boleh karakter khusus)',
            element: document.querySelector('label[for="username"] .input-requirements li:nth-child(2)')
            }
        ];

        var passwordValidityChecks = [
            {
                isInvalid: function(input) {
                    return input.value.length < 8 | input.value.length > 100;
                },
                invalidityMessage: 'Panjang minimal 8 karakter (dan kurang dari 100 karakter)',
                element: document.querySelector('label[for="password"] .input-requirements li:nth-child(1)')
            },
            {
                isInvalid: function(input) {
                    return !input.value.match(/[0-9]/g);
                },
                invalidityMessage: 'Berisi setidaknya 1 Angka',
                element: document.querySelector('label[for="password"] .input-requirements li:nth-child(2)')
            },
            {
                isInvalid: function(input) {
                    return !input.value.match(/[a-z]/g);
                },
                invalidityMessage: 'Berisi minimal 1 huruf kecil',
                element: document.querySelector('label[for="password"] .input-requirements li:nth-child(3)')
            },
            {
                isInvalid: function(input) {
                    return !input.value.match(/[A-Z]/g);
                },
                invalidityMessage: 'Berisi minimal 1 huruf besar',
                element: document.querySelector('label[for="password"] .input-requirements li:nth-child(4)')
            },
            {
                isInvalid: function(input) {
                    return !input.value.match(/[\!\@\#\$\%\^\&\*]/g);
                },
                invalidityMessage: 'Berisi karakter khusus (contoh: @ ! & #)',
                element: document.querySelector('label[for="password"] .input-requirements li:nth-child(5)')
            }
        ];

        var passwordRepeatValidityChecks = [
            {
                isInvalid: function() {
                    return passwordRepeatInput.value != passwordInput.value;
                },
                invalidityMessage: 'Kata sandi ini harus cocok dengan yang pertama'
            }
        ];

        function checkValidity(input) {
            input.CustomValidation.invalidities = [];
            input.CustomValidation.checkValidity(input);

            if(input.CustomValidation.invalidities.length == 0 && input.value != ''){
                input.setCustomValidity('');
            }else{
                var message = input.CustomValidation.getInvalidities();
                input.setCustomValidity(message);
            }
        }

        var usernameInput = document.getElementById('username');
        var passwordInput = document.getElementById('password');
        var passwordRepeatInput = document.getElementById('password_repeat');

        usernameInput.CustomValidation = new CustomValidation(usernameInput);
        usernameInput.CustomValidation.validityChecks = usernameValidityChecks;

        passwordInput.CustomValidation = new CustomValidation(passwordInput);
        passwordInput.CustomValidation.validityChecks = passwordValidityChecks;

        passwordRepeatInput.CustomValidation = new CustomValidation(passwordRepeatInput);
        passwordRepeatInput.CustomValidation.validityChecks = passwordRepeatValidityChecks;


        var inputs = document.querySelectorAll('input:not([type="submit"])');
        for (var i = 0; i < inputs.length; i++) {
            inputs[i].addEventListener('keyup', function () {
                checkValidity(this);
        });
        }

        var submit = document.querySelector('input[type="submit"]');
        submit.addEventListener('click', function(){
            for (var i = 0; i < inputs.length; i++) {
                checkValidity(this);
            }
        });

    </script>
</body>
</html>